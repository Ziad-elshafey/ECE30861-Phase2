#!/bin/bash
#
# Executable entry point - Bash version
#

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$SCRIPT_DIR"

# Function to show usage
show_usage() {
    echo "Usage: $0 <command>" >&2
    echo "Commands:" >&2
    echo "  install        - Install dependencies" >&2
    echo "  test          - Run test suite" >&2
    echo "  <URL_FILE>    - Process URLs from file" >&2
    exit 1
}

# Function to install dependencies
install_deps() {
    echo "Installing dependencies..."
    if python3 -m pip install -r "$PROJECT_ROOT/requirements.txt"; then
        echo "Dependencies installed successfully."
        exit 0
    else
        echo "Failed to install dependencies" >&2
        exit 1
    fi
}

# Function to run tests
run_tests() {
    echo "Running test suite..."
    cd "$PROJECT_ROOT"
    if python3 -c "
import sys
sys.path.insert(0, '.')
from src.cli import run_tests
run_tests()
"; then
        exit 0
    else
        echo "Test execution failed" >&2
        exit 1
    fi
}

# Function to process URLs
process_urls() {
    local url_file="$1"
    
    # Check if file exists
    if [[ ! -f "$url_file" ]]; then
        echo "Error: URL file '$url_file' does not exist." >&2
        exit 1
    fi
    
    echo "Processing URLs from: $url_file"
    cd "$PROJECT_ROOT"
    if python3 -c "
import sys
sys.path.insert(0, '.')
from src.cli import _validate_environment, process_urls
_validate_environment()
process_urls('$url_file')
"; then
        exit 0
    else
        echo "URL processing failed" >&2
        exit 1
    fi
}

# Main script logic
main() {
    # Check if at least one argument is provided
    if [[ $# -lt 1 ]]; then
        show_usage
    fi
    
    local command="$1"
    
    case "$command" in
        "install")
            install_deps
            ;;
        "test")
            run_tests
            ;;
        *)
            # Treat as URL file path
            process_urls "$command"
            ;;
    esac
}
# Run main function with all arguments
main "$@"
        